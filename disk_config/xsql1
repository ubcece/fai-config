# This disk_config is suitable for a server with two >70GB and <2TB hard disks to be put in RAID1.

# 2009-10-07 Derek Poon <derekp@ece.ubc.ca>
# In FAI 3.2.17, setup-storage has a bug: if an LVM volume group already
# exists, running setup-storage a second time causes an error:
# "Cannot satisfy pre-depends for vgreduce vg /dev/.... -- system left untouched."
# A workaround is to first run "/sbin/vgremove some_vg_name". Done in hooks/partition.GRUB2

# 2010-10-04 Chris Dumont. Another limitation of FAI 3.2.17 is that
# setup-storage can't set the partiion flags. See hooks/mountdisk.GRUB2
# A bit of a fib: the "bootable:3" option. GPT doesn't have bootable flags. But
# we use it to fool setup-storage into correctly setting BOOT_DEVICE (to
# /dev/sda). Otherwise setup-storage defaults to incorrectly setting
# BOOT_DEVICE to the same as BOOT_PARTITION (to /dev/mapper/vg-root1).
# The 1M partition is for gpt's sake. Somewhat like the old way of having a
# separate /boot but for quite different reasons.

# SSD to be RAID1 member...
disk_config	disk1	disklabel:gpt	fstabkey:uuid	bootable:3
primary		-							200M	-	-
primary		swap					8G	swap	rw
primary		-							60G-	-	-

# ... and another to be its mirror
disk_config	disk2	disklabel:gpt	fstabkey:uuid	bootable:3
primary		-							200M	-	-
primary		swap					8G	swap	rw
primary		-							60G-	-	-

disk_config	raid	fstabkey:uuid preserve_reinstall:1
# Define md0...
raid1		-						disk1.3,disk2.3	-	-

disk_config	lvm	fstabkey:uuid
vg		vg				md0
vg-root1	/				9G-10G	ext3	rw,errors=remount-ro
vg-var1		/var				9G-10G	ext3	rw
vg-root2	/altroot			9G-10G	ext3	rw
vg-var2		/altroot/var			9G-10G	ext3	rw
vg-tmp		/tmp				18G-20G	ext3	rw
vg-data		/data				5G-	xfs	rw,noatime
# Leave some unused space in vg for snapshot volume
# derekp: Don't know if FAI lets you reserve space by omitting the filesystem type
vg-snapreserve  -				10G-20G	-	-

