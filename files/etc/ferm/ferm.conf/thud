# -*- shell-script -*-
#
#  Configuration file for ferm(1).
#

table filter {
    chain INPUT {
        policy DROP;

        # connection tracking
        mod state state INVALID DROP;
        mod state state (ESTABLISHED RELATED) ACCEPT;

        # allow local packages
        interface lo ACCEPT;

        # respond to ping
        proto icmp ACCEPT; 

	interface ( vlan217 ) { # external
		protocol ( udp ) dport ( 5000:5010 ) { # openvpn
			saddr ( 137.82.84.33 ) ACCEPT; # qux-m2-1036.ece.ubc.ca (PPC)
			saddr ( 137.82.84.25 ) ACCEPT; # baz-m2-833.ece.ubc.ca (BRIM)
		}
	}

        # allow SSH connections
	interface eth2 proto tcp dport ssh ACCEPT; # The interface restriction
		# is not so much for security but that thudvpn will likely
		# route reply packets incorrectly.

	REJECT; # Aren't we thoughtful.
    }
    chain OUTPUT {
        policy ACCEPT;

        # connection tracking
        #mod state state INVALID DROP;
        mod state state (ESTABLISHED RELATED) ACCEPT;
    }
    chain FORWARD {
        policy DROP;

        # connection tracking
        mod state state INVALID DROP;
        mod state state (ESTABLISHED RELATED) ACCEPT;
	interface ( br70 br218 br1395 ) ACCEPT;
    }
}

